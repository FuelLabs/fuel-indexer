<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Indexing Custom Types - The Fuel Indexer Service</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">The Fuel Indexer</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting Started</li><li class="chapter-item expanded "><a href="../getting-started/dependencies.html"><strong aria-hidden="true">1.</strong> Dependencies</a></li><li class="chapter-item expanded "><a href="../getting-started/indexer-service-infrastructure.html"><strong aria-hidden="true">2.</strong> Service Infrastructure</a></li><li class="chapter-item expanded "><a href="../getting-started/how-it-compares.html"><strong aria-hidden="true">3.</strong> How it Compares</a></li><li class="chapter-item expanded "><a href="../getting-started/quickstart.html"><strong aria-hidden="true">4.</strong> Quickstart</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="../project-components/index.html"><strong aria-hidden="true">5.</strong> Project Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../project-components/manifest.html"><strong aria-hidden="true">5.1.</strong> Manifest</a></li><li class="chapter-item expanded "><a href="../project-components/schema.html"><strong aria-hidden="true">5.2.</strong> Schema</a></li><li class="chapter-item expanded "><a href="../project-components/module.html"><strong aria-hidden="true">5.3.</strong> Module</a></li></ol></li><li class="chapter-item expanded "><a href="../designing-a-schema/index.html"><strong aria-hidden="true">6.</strong> Designing a Schema</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../designing-a-schema/types.html"><strong aria-hidden="true">6.1.</strong> Types</a></li><li class="chapter-item expanded "><a href="../designing-a-schema/scalars.html"><strong aria-hidden="true">6.2.</strong> Scalars</a></li><li class="chapter-item expanded "><a href="../designing-a-schema/directives.html"><strong aria-hidden="true">6.3.</strong> Directives</a></li><li class="chapter-item expanded "><a href="../designing-a-schema/relationships.html"><strong aria-hidden="true">6.4.</strong> Relationships</a></li></ol></li><li class="chapter-item expanded "><a href="../indexing-fuel-types/index.html"><strong aria-hidden="true">7.</strong> Indexing Fuel Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../indexing-fuel-types/blocks.html"><strong aria-hidden="true">7.1.</strong> Blocks</a></li><li class="chapter-item expanded "><a href="../indexing-fuel-types/transactions.html"><strong aria-hidden="true">7.2.</strong> Transactions</a></li><li class="chapter-item expanded "><a href="../indexing-fuel-types/receipts.html"><strong aria-hidden="true">7.3.</strong> Receipts</a></li></ol></li><li class="chapter-item expanded "><a href="../indexing-custom-types/index.html" class="active"><strong aria-hidden="true">8.</strong> Indexing Custom Types</a></li><li class="chapter-item expanded "><a href="../storing-records/index.html"><strong aria-hidden="true">9.</strong> Storing Records</a></li><li class="chapter-item expanded "><a href="../querying/index.html"><strong aria-hidden="true">10.</strong> Querying</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../querying/basic-queries.html"><strong aria-hidden="true">10.1.</strong> Basic Queries</a></li><li class="chapter-item expanded "><a href="../querying/playground.html"><strong aria-hidden="true">10.2.</strong> Playground</a></li><li class="chapter-item expanded "><a href="../querying/search-and-filtering.html"><strong aria-hidden="true">10.3.</strong> Search and Filtering</a></li><li class="chapter-item expanded "><a href="../querying/pagination.html"><strong aria-hidden="true">10.4.</strong> Pagination</a></li><li class="chapter-item expanded "><a href="../querying/full-example.html"><strong aria-hidden="true">10.5.</strong> A Full Example</a></li></ol></li><li class="chapter-item expanded "><a href="../authentication/index.html"><strong aria-hidden="true">11.</strong> Authentication</a></li><li class="chapter-item expanded "><a href="../forc-index/index.html"><strong aria-hidden="true">12.</strong> forc index</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../forc-index/auth.html"><strong aria-hidden="true">12.1.</strong> auth</a></li><li class="chapter-item expanded "><a href="../forc-index/build.html"><strong aria-hidden="true">12.2.</strong> build</a></li><li class="chapter-item expanded "><a href="../forc-index/check.html"><strong aria-hidden="true">12.3.</strong> check</a></li><li class="chapter-item expanded "><a href="../forc-index/deploy.html"><strong aria-hidden="true">12.4.</strong> deploy</a></li><li class="chapter-item expanded "><a href="../forc-index/kill.html"><strong aria-hidden="true">12.5.</strong> kill</a></li><li class="chapter-item expanded "><a href="../forc-index/new.html"><strong aria-hidden="true">12.6.</strong> new</a></li><li class="chapter-item expanded "><a href="../forc-index/remove.html"><strong aria-hidden="true">12.7.</strong> remove</a></li><li class="chapter-item expanded "><a href="../forc-index/start.html"><strong aria-hidden="true">12.8.</strong> start</a></li><li class="chapter-item expanded "><a href="../forc-index/status.html"><strong aria-hidden="true">12.9.</strong> status</a></li></ol></li><li class="chapter-item expanded "><a href="../forc-postgres/index.html"><strong aria-hidden="true">13.</strong> forc postgres</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../forc-postgres/create.html"><strong aria-hidden="true">13.1.</strong> create</a></li><li class="chapter-item expanded "><a href="../forc-postgres/drop.html"><strong aria-hidden="true">13.2.</strong> drop</a></li><li class="chapter-item expanded "><a href="../forc-postgres/start.html"><strong aria-hidden="true">13.3.</strong> start</a></li><li class="chapter-item expanded "><a href="../forc-postgres/stop.html"><strong aria-hidden="true">13.4.</strong> stop</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">For Contributors</li><li class="chapter-item expanded "><a href="../for-contributors/index.html"><strong aria-hidden="true">14.</strong> Environment Setup</a></li><li class="chapter-item expanded "><a href="../for-contributors/contributing-standards.html"><strong aria-hidden="true">15.</strong> Contributing Standards</a></li><li class="chapter-item expanded "><a href="../for-contributors/release-schedule.html"><strong aria-hidden="true">16.</strong> Release Schedule</a></li><li class="chapter-item expanded "><a href="../for-contributors/building-from-source.html"><strong aria-hidden="true">17.</strong> Building From Source</a></li><li class="chapter-item expanded "><a href="../for-contributors/system-dependencies.html"><strong aria-hidden="true">18.</strong> System Dependencides</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">19.</strong> A: Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Fuel Indexer Service</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/FuelLabs/fuel-indexer" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="custom-types"><a class="header" href="#custom-types">Custom Types</a></h1>
<ol>
<li><a href="#1-contract">Contract</a></li>
<li><a href="#2-schema">Schema</a></li>
<li><a href="#3-manifest">Manifest</a></li>
<li><a href="#4-handler-logic">Writing a handler</a></li>
</ol>
<blockquote>
<p>In addition to Fuel-specific types, you can also index custom types triggered in your Sway smart contract.</p>
</blockquote>
<p>To index custom types from a Sway smart contract, you'll need that specific contract's ABI in JSON format; the JSON ABI is generated as a result of running <code>forc build</code> to build your contract. After that, the process is similar to <a href="../indexing-fuel-types/index.html">indexing Fuel types</a>.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>Let's cover some of these concepts in an example below.</p>
<h3 id="1-contract"><a class="header" href="#1-contract">1. Contract</a></h3>
<p>First, let's create a Sway contract with some simple types.</p>
<pre><code class="language-sway">contract;

use std::logging::log;

struct Addition {
    added_value: u64,
    updated_total: u64,
}

struct Subtraction {
    subtracted_value: u64,
    updated_total: u64,
}

abi ValueStore {
    #[storage(read, write)]
    fn add(value: u64);

    #[storage(read, write)]
    fn subtract(value: u64) -&gt; Subtraction;
}

storage {
    total: u64 = 1000,
}

impl ValueStore for Contract {
    #[storage(read, write)]
    fn add(value: u64) {
        let updated_total = storage.total.read() + value;
        storage.total.write(updated_total);
        log(
            Addition {
                added_value: value,
                updated_total
            }
        )
    }

    #[storage(read, write)]
    fn subtract(value: u64) -&gt; Subtraction {
        let updated_total = storage.total.read() - value;
        storage.total.write(updated_total);

        Subtraction {
            subtracted_value: value,
            updated_total
        }
    }
}
</code></pre>
<ul>
<li>In this contract, we have two types: <code>Addition</code> and <code>Subtraction</code>. As we'll soon see, indexers can process custom types that are logged or returned as part of a function.</li>
<li>To begin creating an indexer for this contract, let's build the contract and generate a JSON ABI file.
<ul>
<li>Running <code>forc build</code> generates a JSON ABI similar to the lightly-edited one below:</li>
</ul>
</li>
</ul>
<pre><code class="language-json">{
  &quot;types&quot;: [
    {
      &quot;typeId&quot;: 0,
      &quot;type&quot;: &quot;()&quot;,
      &quot;components&quot;: [],
      &quot;typeParameters&quot;: null
    },
    {
      &quot;typeId&quot;: 1,
      &quot;type&quot;: &quot;struct Addition&quot;,
      &quot;components&quot;: [
        {
          &quot;name&quot;: &quot;added_value&quot;,
          &quot;type&quot;: 3,
          &quot;typeArguments&quot;: null
        },
        {
          &quot;name&quot;: &quot;updated_total&quot;,
          &quot;type&quot;: 3,
          &quot;typeArguments&quot;: null
        }
      ],
      &quot;typeParameters&quot;: null
    },
    {
      &quot;typeId&quot;: 2,
      &quot;type&quot;: &quot;struct Subtraction&quot;,
      &quot;components&quot;: [
        {
          &quot;name&quot;: &quot;subtracted_value&quot;,
          &quot;type&quot;: 3,
          &quot;typeArguments&quot;: null
        },
        {
          &quot;name&quot;: &quot;updated_total&quot;,
          &quot;type&quot;: 3,
          &quot;typeArguments&quot;: null
        }
      ],
      &quot;typeParameters&quot;: null
    },
    {
      &quot;typeId&quot;: 3,
      &quot;type&quot;: &quot;u64&quot;,
      &quot;components&quot;: null,
      &quot;typeParameters&quot;: null
    }
  ],
  &quot;functions&quot;: [...],
  &quot;loggedTypes&quot;: [
    {
      &quot;logId&quot;: 0,
      &quot;loggedType&quot;: {
        &quot;name&quot;: &quot;&quot;,
        &quot;type&quot;: 1,
        &quot;typeArguments&quot;: []
      }
    }
  ],
  &quot;messagesTypes&quot;: [...],
  &quot;configurables&quot;: [...]
}

</code></pre>
<h2 id="2-schema"><a class="header" href="#2-schema">2. Schema</a></h2>
<p>Now that we've discussed how to generate the JSON ABI for our Sway smart contract, let's now cover how to create an associated GraphQL schema.</p>
<p>To index the contracts and store information about our Sway types in the database, we should create a schema. Let's design a schema that has an entity for each Sway type:</p>
<pre><code class="language-graphql">type AddEntity @entity {
  id: ID!
  value: U64!
  updated_total: U64!
}

type SubtractEntity @entity {
  id: ID!
  value: U64!
  updated_total: U64!
}
</code></pre>
<blockquote>
<p>Note how the types used here, match the types used in our Sway smart contract. For a detailed mapping of these types, please see the <a href="./../storing-records/index.html">Storing Records</a> section.</p>
</blockquote>
<h2 id="3-manifest"><a class="header" href="#3-manifest">3. Manifest</a></h2>
<p>So far we've covered how to (1) write your Sway smart contract and generate its JSON ABI, and (2) create types in your GraphQL schema that align with your Sway types.</p>
<p>Next, we'll cover how to write the manifest file for your indexer.</p>
<p>Before writing any of the handler code for your indexer, we need to make sure that our indexer manifest contains the necessary information to allow for the compiler to parse our contract types.</p>
<p>Specifically, we should ensure that the <code>contract_abi</code> and <code>graphql_schema</code> fields point to the correct locations, respectively.</p>
<pre><code class="language-yaml"># A namespace is a logical grouping of declared names. Think of the namespace
# as an organization identifier
namespace: fuellabs

# The identifier field is used to identify the given index.
identifier: custom_types_example

# The abi option is used to provide a link to the Sway JSON ABI that is generated when you
# build your project.
abi: path/to/custom/type/example/contract-abi.json

# The particular start block after which you'd like your indexer to start indexing events.
start_block: ~

# The particular end block after which you'd like your indexer to stop indexing events.
end_block: ~

# The `fuel_client` denotes the address (host, port combination) of the running Fuel client
# that you would like your indexer to index events from. In order to use this per-indexer
# `fuel_client` option, the indexer service at which your indexer is deployed will have to run
# with the `--indexer_net_config` option.
fuel_client: ~

# The contract_id specifies which particular contract you would like your index to subscribe to.
contract_id: ~

# The graphql_schema field contains the file path that points to the GraphQL schema for the
# given index.
graphql_schema: path/to/custom/type/example/indexer.schema.graphql

# The module field contains a file path that points to code that will be run as an executor inside
# of the indexer.
# Important: At this time, wasm is the preferred method of execution.
module:
  wasm: ~

# The resumable field contains a boolean that specifies whether or not the indexer should, synchronise
# with the latest block if it has fallen out of sync.
resumable: true
</code></pre>
<h2 id="4-handler-logic"><a class="header" href="#4-handler-logic">4. Handler Logic</a></h2>
<p>Finally, we can create handlers to index these particular types and store them in the database. Let's look at the following example:</p>
<pre><code class="language-rust  ignore">use fuel_indexer_utils::prelude::*;

#[indexer(manifest = &quot;indexer.manifest.yaml&quot;)]
mod indexer_mod {
    fn index_addition(addition_event: Addition) {
        let addition = AddEntity {
          id: 123,
          value: addition_event.added_value,
          updated_total: addition_event.updated_total
        };
        addition.save();
    }

    fn index_subtraction(subtraction_event: Subtraction) {
        let subtraction = SubtractEntity {
          id: 123,
          value: subtraction_event.subtracted_value,
          updated_total: subtraction_event.updated_total
        };
        subtraction.save();
    }
}</code></pre>
<p>Regardless of whether a custom type was logged (e.g. <code>Addition</code>) or returned (e.g. <code>Subtraction</code>), the type will be available for you to use in your functions. Just include the type(s) you want your function to use in the parameters, and the function will be executed whenever each of the parameters have been satisfied by an instance of the type(s).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../indexing-fuel-types/receipts.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../storing-records/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../indexing-fuel-types/receipts.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../storing-records/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
